# TODO

## Now (W toku)
_brak_

## Next (Kolejne)
- [ ] Idea Gate + unikalność pomysłów (branch: feat/idea-gate)
  - [ ] Propozycja 3–5 pomysłów i wybór operatora (opcjonalnie auto)
  - [ ] Hash DSL + embedding pomysłu do wykrywania podobieństw
  - [ ] Próg podobieństwa + oznaczanie zbyt podobnych pomysłów
- [ ] Konfiguracja i dokumentacja pipeline (branch: docs/pipeline-ops)
  - [ ] Opisać minimalny flow uruchomienia (worker/enqueue/job-status)
  - [ ] Opisać zmienne `.env` (REDIS_URL, RQ_*_TIMEOUT, FFMPEG_TIMEOUT_S)
  - [ ] Dodać notkę o typowych problemach (ffmpeg hang + rozwiązanie)

## Done (Zrobione)
- [x] Cleanup i obserwowalność pipeline (branch: chore/pipeline-maintenance) (2026-02-02)
  - [x] Wyczyścić/oznaczyć stare joby „running” w DB (po timeoutach) (2026-02-02)
  - [x] Dodać prosty status komendy: summary (queued/running/failed/succeeded) (2026-02-02)
  - [x] Dodać instrukcję cleanupu FailedJobRegistry w README/Makefile (2026-02-02)
- [x] Minimalny worker pipeline (branch: feat/pipeline-mvp) (2026-02-02)
  - [x] Zdefiniować minimalny kontrakt jobów i statusów (queued/running/succeeded/failed) (2026-02-02)
  - [x] Dodać modele DB: Job/Stage lub wykorzystać istniejące (AuditLog) do statusów (2026-02-02)
  - [x] Wpiąć RQ + Redis i dodać worker CLI (start/stop) (2026-02-02)
  - [x] Zaimplementować minimalny flow: generacja DSL -> render CLI (2026-02-02)
  - [x] Zastąpić stub generacji DSL (kopiowanie template) prawdziwą generacją (2026-02-02)
  - [x] Zapis statusów i artefaktów (DSL path, video path, metadata path) (2026-02-02)
  - [x] Retry podstawowy dla failed (manualny rerun) (2026-02-02)
  - [x] Dodać make targets: worker, enqueue, status (2026-02-02)
  - [x] Uruchomić `make db-migrate` lokalnie (tabela jobs) (2026-02-02)
  - [x] Zainstalować zależności pipeline (`make deps-py-uv`) i potwierdzić `rq`/`redis` (2026-02-02)
  - [x] Podnieść timeout renderu i dodać hooki on_failure/on_success dla RQ (2026-02-02)
  - [x] Zweryfikować, czy render job kończy się `succeeded` po zmianie timeoutu (2026-02-02)
  - [x] Zdiagnozować długotrwały render (ffmpeg/renderer) i ustalić docelowy timeout (2026-02-02)
  - [x] Sprawdzić ręczny render CLI na DSL z pipeline (czy ffmpeg kończy) (2026-02-02)
  - [x] Użyć absolutnych ścieżek + `-nostdin` w ffmpeg (unikać zależności od CWD) (2026-02-02)
  - [x] Dodać timeout i weryfikację outputu ffmpeg w rendererze (2026-02-02)
- [x] Baza danych + migracje (branch: feat/db-schema) (2026-02-02)
  - [x] Szkielet DB (Postgres + Alembic) (2026-02-01)
  - [x] Podstawowy model danych: animacja, render, QC, audit (2026-02-01)
  - [x] Dostosować PGDATA/volume dla Postgresa 18 (2026-02-02)
  - [x] Ustalić działający obraz MinIO (minio/minio vs alpine/minio) (2026-02-02)
  - [x] Migracje startowe (2026-02-02)
  - [x] Naprawić nagłówek migracji Alembic (nierenderowane placeholdery) (2026-02-02)
  - [x] Zweryfikować konfigurację template Alembic (nagłówki w nowych migracjach) (2026-02-02)
  - [x] Rozważyć server_default dla timestamps (created_at/updated_at) na poziomie DB (2026-02-02)
  - [x] Rozwiązać panic uv przy `make db-migrate` na macOS (system-configuration / Tokio executor) (2026-02-02)
  - [x] Uruchomić `make db-migrate` lokalnie (poza sandboxem) i potwierdzić sukces (2026-02-02)
- [x] Renderer: implementacja reguł (branch: feat/renderer-rules) (2026-02-01)
  - [x] Reguły: move / orbit / attract / repel (2026-02-01)
  - [x] Reguły: split / merge / decay (2026-02-01)
  - [x] Reguły: memory + ślady (2026-02-01)
  - [x] FSM w rendererze (2026-02-01)
  - [x] Zgodność kolejności ewaluacji z DSL (forces/interactions/constraints) (2026-02-01)
  - [x] Obsługa selectorów `tag:`/`all` i wyboru „najbliższego” w center/target (2026-02-01)
  - [x] Emitery: spawny w czasie zgodne z DSL v1.1 (2026-02-01)
  - [x] Emitery: obsłużyć `entities.size` z min/max/distribution (2026-02-01)
  - [x] Constraints/bounds: clamp/bounce/wrap zgodnie z DSL v1.1 (2026-02-01)
  - [x] Bounds: uwzględnić rozmiar obiektu (radius) w clamp/bounce (2026-02-01)
  - [x] Forces: gravity/noise zgodnie z DSL v1.1 (2026-02-01)
  - [x] Forces: uwzględnić `noise.scale` i `noise.seed` (2026-02-01)
  - [x] Doprecyzować obsługę `entities.size.value` (usunąć lub dodać do DSL) (2026-02-01)
  - [x] Forces: ustalić zachowanie `noise.seed` w czasie (statyczny vs zmienny) (2026-02-01)
  - [x] Zgodność reguł z DSL v1.1 (po rozszerzeniu) (2026-02-01)
  - [x] Interactions: implementacja `systems.interactions` (pairs + when) (2026-02-01)
  - [x] FSM: obsługa `metric` (przynajmniej population) (2026-02-01)
  - [x] Termination: obsługa `condition.type = metric` (przynajmniej population) (2026-02-01)
  - [x] Interactions: obsługa `merge`/`split` w `systems.interactions` (2026-02-01)
  - [x] Metryki: `coverage` / `entropy` / `stability` w FSM i termination (2026-02-01)
  - [x] Interactions: stabilne RNG dla `when.probability` (2026-02-01)
  - [x] Metryki: doprecyzować semantykę (coverage/stability/entropy) i dostosować implementację (2026-02-01)
  - [x] Interactions: split/merge zgodne z parametrami DSL (np. angle_threshold_deg) (2026-02-01)
- [x] DSL v1.1 rozszerzenia (branch: feat/dsl-v1-1) (2026-02-01)
- [x] Utworzenie TODO.md (branch: chore/todo) (2026-01-30)
  - [x] Zdefiniować strukturę zadań i zasady utrzymania TODO (2026-01-30)
- [x] Dev environment bootstrap (branch: chore/dev-setup) (2026-01-31)
  - [x] Zweryfikować i uzupełnić środowisko dev na macOS (Brewfile + versions.env)
  - [x] Przygotować skrypt bootstrapu macOS (scripts/setup-macos.sh) i wpisać do Makefile (2026-01-30)
  - [x] Wymusić użycie /opt/homebrew w bootstrapie i zweryfikować ścieżkę brew (2026-01-30)
  - [x] Instalować tylko brakujące brew/cask (pomijać istniejący Docker.app) (2026-01-30)
  - [x] Trwale pominąć instalację Docker cask w bootstrapie (2026-01-30)
  - [x] Przenieść wersje Python/Node do mise i dodać .mise.toml (2026-01-31)
  - [x] Zaufać konfiguracji mise (mise trust) (2026-01-31)
  - [x] Naprawić uprawnienia Homebrew i cache (np. /opt/homebrew/Cellar, /opt/homebrew/var/homebrew/locks, ~/Library/Caches/Homebrew) (2026-01-31)
  - [x] Sprawdzić ACL/flags blokujące zapis (np. /opt/homebrew/var/homebrew/locks, ~/Library/Caches/Homebrew) (2026-01-31)
  - [x] Ustawić Node 24 jako aktywny przez mise (2026-01-31)
  - [x] Ustalić, że `make verify` traktuje skia-python i usługi z compose jako opcjonalne (2026-01-31)
  - [x] Usunąć tap `homebrew/bundle` z Brewfile (tap zdeprecjonowany) (2026-01-30)
  - [x] Uruchomić bootstrap lokalnie i potwierdzić działanie (make setup-macos, make verify) (2026-01-31)
  - [x] Spisać minimalne kroki uruchomienia lokalnego (README: 5-min quickstart) (2026-01-31)
- [x] DSL v1 + walidacja (branch: feat/dsl-v1) (2026-02-01)
  - [x] Opisać DSL v1: struktura pliku, pola wymagane, opcjonalne, wersjonowanie (2026-01-31)
  - [x] Zdefiniować minimalny kontrakt FSM (stany, przejścia, parametry, wejścia/wyjścia) (2026-01-31)
  - [x] Przygotować 2 przykładowe pliki DSL v1 (happy path + edge case) (2026-01-31)
  - [x] Wybrać format wejścia (JSON albo YAML) i uzasadnić w krótkiej notce (2026-01-31)
  - [x] Zaimplementować schemat DSL (pydantic/jsonschema) + walidator wejścia (2026-01-31)
  - [x] Dodać testy walidacji DSL (min. valid/invalid cases) (2026-01-31)
  - [x] Dodać zależności Python (pyproject + lock) dla DSL/testów (pydantic, pyyaml, pytest) (2026-02-01)
  - [x] Usunąć warningi Pydantic v2 (Config -> ConfigDict) (2026-02-01)
- [x] Minimalny renderer MVP (branch: feat/renderer-mvp) (2026-02-01)
  - [x] Renderer Python + Cairo z deterministycznym seedingiem (2026-02-01)
  - [x] Metadane renderu: seed, dsl_version, design_system_version, parametry symulacji (2026-02-01)
  - [x] Ustalić spójną wersję FFmpeg w PATH (obecnie używany 7.1.1 vs pinned 8.0.1) (2026-02-01)
  - [x] Ostrzeganie o nieobsługiwanych regułach/FSM w rendererze (2026-02-01)
- [x] CLI do renderu (branch: feat/render-cli) (2026-02-01)
  - [x] Wejście: DSL + seed, wyjście: wideo + metadane (2026-02-01)
  - [x] Walidacja wejścia i czytelne błędy (2026-02-01)
- [x] Deterministyczność renderu (branch: test/renderer-golden) (2026-02-01)
  - [x] Golden tests (min. 2 przypadki) (2026-02-01)
  - [x] Tolerancje porównań i dokumentacja (2026-02-01)

## Zasady
- Jeden właściciel taska i jeden cel; task ma kończyć się działającym artefaktem lub testem
- Przenoś zadania między sekcjami tylko przy zmianie statusu (Now -> Done, Next -> Now)
- Dopisuj datę przy ukończonych zadaniach w sekcji Done, np. "(2026-01-30)"
- Zadania główne odpowiadają branchom (jedno zadanie = jeden branch), podzadania realizujemy w ramach tego brancha
- Preferowane prefiksy branchy: `feat/`, `chore/`, `test/`, `docs/`, `fix/`
- Zadanie główne powinno być zamykalne w 1–3 dni robocze; jeśli rośnie, podziel je na dwa branche
- TODO utrzymujemy jako 2 poziomy: tylko zadania główne + podzadania (bez kolejnych poziomów)
- Liczba podzadań jest elastyczna (1–7); przy 1 podzadaniu upewnij się, że branch nadal ma sens
- Przykład małego brancha: dokument/konwencja w jednym pliku (np. TODO, README, RFC-lite)

## Notatki / decyzje
- Docker Desktop instalujemy manualnie (bootstrap pomija cask docker).
- Python/Node instalujemy i pinujemy przez mise (`.mise.toml`).
- `make verify` traktuje skia-python i usługi z compose jako opcjonalne do czasu uruchomienia renderera i infra.
- Timestamps zostają na poziomie aplikacji (brak `server_default`) w MVP; ewentualne server-side defaults wymagają nowej migracji/triggerów.
